{"version":3,"file":"_page.svelte.js","sources":["../../../../../../../../src/lib/components/chat/MessageInput/VoiceRecording.svelte","../../../../../../../../src/lib/components/icons/CloudArrowUp.svelte","../../../../../../../../src/lib/components/notes/Notes/NoteMenu.svelte","../../../../../../../../src/lib/components/icons/Calendar.svelte","../../../../../../../../src/lib/components/icons/Users.svelte","../../../../../../../../src/lib/components/icons/Mic.svelte","../../../../../../../../src/lib/components/icons/CursorArrowRays.svelte","../../../../../../../../src/lib/components/notes/RecordMenu.svelte","../../../../../../../../src/lib/components/icons/SparklesSolid.svelte","../../../../../../../../src/lib/components/icons/ArrowUturnLeft.svelte","../../../../../../../../src/lib/components/icons/ArrowUturnRight.svelte","../../../../../../../../src/lib/components/notes/NoteEditor.svelte","../../../../../../../../src/routes/(app)/notes/[id]/+page.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { toast } from 'svelte-sonner';\n\timport { tick, getContext, onMount, onDestroy } from 'svelte';\n\timport { config, settings } from '$lib/stores';\n\timport { blobToFile, calculateSHA256, extractCurlyBraceWords } from '$lib/utils';\n\n\timport { transcribeAudio } from '$lib/apis/audio';\n\n\timport dayjs from 'dayjs';\n\timport LocalizedFormat from 'dayjs/plugin/localizedFormat';\n\tdayjs.extend(LocalizedFormat);\n\n\tconst i18n = getContext('i18n');\n\n\texport let recording = false;\n\texport let transcribe = true;\n\texport let displayMedia = false;\n\n\texport let className = ' p-2.5 w-full max-w-full';\n\n\texport let onCancel = () => {};\n\texport let onConfirm = (data) => {};\n\n\tlet loading = false;\n\tlet confirmed = false;\n\n\tlet durationSeconds = 0;\n\tlet durationCounter = null;\n\n\tlet transcription = '';\n\n\tconst startDurationCounter = () => {\n\t\tdurationCounter = setInterval(() => {\n\t\t\tdurationSeconds++;\n\t\t}, 1000);\n\t};\n\n\tconst stopDurationCounter = () => {\n\t\tclearInterval(durationCounter);\n\t\tdurationSeconds = 0;\n\t};\n\n\t$: if (recording) {\n\t\tstartRecording();\n\t} else {\n\t\tstopRecording();\n\t}\n\n\tconst formatSeconds = (seconds) => {\n\t\tconst minutes = Math.floor(seconds / 60);\n\t\tconst remainingSeconds = seconds % 60;\n\t\tconst formattedSeconds = remainingSeconds < 10 ? `0${remainingSeconds}` : remainingSeconds;\n\t\treturn `${minutes}:${formattedSeconds}`;\n\t};\n\n\tlet stream;\n\tlet speechRecognition;\n\n\tlet mediaRecorder;\n\tlet audioChunks = [];\n\n\tconst MIN_DECIBELS = -45;\n\tlet VISUALIZER_BUFFER_LENGTH = 300;\n\n\tlet visualizerData = Array(VISUALIZER_BUFFER_LENGTH).fill(0);\n\n\t// Function to calculate the RMS level from time domain data\n\tconst calculateRMS = (data: Uint8Array) => {\n\t\tlet sumSquares = 0;\n\t\tfor (let i = 0; i < data.length; i++) {\n\t\t\tconst normalizedValue = (data[i] - 128) / 128; // Normalize the data\n\t\t\tsumSquares += normalizedValue * normalizedValue;\n\t\t}\n\t\treturn Math.sqrt(sumSquares / data.length);\n\t};\n\n\tconst normalizeRMS = (rms) => {\n\t\trms = rms * 10;\n\t\tconst exp = 1.5; // Adjust exponent value; values greater than 1 expand larger numbers more and compress smaller numbers more\n\t\tconst scaledRMS = Math.pow(rms, exp);\n\n\t\t// Scale between 0.01 (1%) and 1.0 (100%)\n\t\treturn Math.min(1.0, Math.max(0.01, scaledRMS));\n\t};\n\n\tconst analyseAudio = (stream) => {\n\t\tconst audioContext = new AudioContext();\n\t\tconst audioStreamSource = audioContext.createMediaStreamSource(stream);\n\n\t\tconst analyser = audioContext.createAnalyser();\n\t\tanalyser.minDecibels = MIN_DECIBELS;\n\t\taudioStreamSource.connect(analyser);\n\n\t\tconst bufferLength = analyser.frequencyBinCount;\n\n\t\tconst domainData = new Uint8Array(bufferLength);\n\t\tconst timeDomainData = new Uint8Array(analyser.fftSize);\n\n\t\tlet lastSoundTime = Date.now();\n\n\t\tconst detectSound = () => {\n\t\t\tconst processFrame = () => {\n\t\t\t\tif (!recording || loading) return;\n\n\t\t\t\tif (recording && !loading) {\n\t\t\t\t\tanalyser.getByteTimeDomainData(timeDomainData);\n\t\t\t\t\tanalyser.getByteFrequencyData(domainData);\n\n\t\t\t\t\t// Calculate RMS level from time domain data\n\t\t\t\t\tconst rmsLevel = calculateRMS(timeDomainData);\n\t\t\t\t\t// Push the calculated decibel level to visualizerData\n\t\t\t\t\tvisualizerData.push(normalizeRMS(rmsLevel));\n\n\t\t\t\t\t// Ensure visualizerData array stays within the buffer length\n\t\t\t\t\tif (visualizerData.length >= VISUALIZER_BUFFER_LENGTH) {\n\t\t\t\t\t\tvisualizerData.shift();\n\t\t\t\t\t}\n\n\t\t\t\t\tvisualizerData = visualizerData;\n\n\t\t\t\t\t// if (domainData.some((value) => value > 0)) {\n\t\t\t\t\t// \tlastSoundTime = Date.now();\n\t\t\t\t\t// }\n\n\t\t\t\t\t// if (recording && Date.now() - lastSoundTime > 3000) {\n\t\t\t\t\t// \tif ($settings?.speechAutoSend ?? false) {\n\t\t\t\t\t// \t\tconfirmRecording();\n\t\t\t\t\t// \t}\n\t\t\t\t\t// }\n\t\t\t\t}\n\n\t\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t\t};\n\n\t\t\twindow.requestAnimationFrame(processFrame);\n\t\t};\n\n\t\tdetectSound();\n\t};\n\n\tconst onStopHandler = async (audioBlob, ext: string = 'wav') => {\n\t\t// Create a blob from the audio chunks\n\n\t\tawait tick();\n\t\tconst file = blobToFile(audioBlob, `Recording-${dayjs().format('L LT')}.${ext}`);\n\n\t\tif (transcribe) {\n\t\t\tif ($config.audio.stt.engine === 'web' || ($settings?.audio?.stt?.engine ?? '') === 'web') {\n\t\t\t\t// with web stt, we don't need to send the file to the server\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst res = await transcribeAudio(\n\t\t\t\tlocalStorage.token,\n\t\t\t\tfile,\n\t\t\t\t$settings?.audio?.stt?.language\n\t\t\t).catch((error) => {\n\t\t\t\ttoast.error(`${error}`);\n\t\t\t\treturn null;\n\t\t\t});\n\n\t\t\tif (res) {\n\t\t\t\tconsole.log(res);\n\t\t\t\tonConfirm(res);\n\t\t\t}\n\t\t} else {\n\t\t\tonConfirm({\n\t\t\t\tfile: file,\n\t\t\t\tblob: audioBlob\n\t\t\t});\n\t\t}\n\t};\n\n\tconst startRecording = async () => {\n\t\tloading = true;\n\n\t\ttry {\n\t\t\tif (displayMedia) {\n\t\t\t\tconst mediaStream = await navigator.mediaDevices.getDisplayMedia({\n\t\t\t\t\taudio: true\n\t\t\t\t});\n\n\t\t\t\tstream = new MediaStream();\n\t\t\t\tfor (const track of mediaStream.getAudioTracks()) {\n\t\t\t\t\tstream.addTrack(track);\n\t\t\t\t}\n\n\t\t\t\tfor (const track of mediaStream.getVideoTracks()) {\n\t\t\t\t\ttrack.stop();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tstream = await navigator.mediaDevices.getUserMedia({\n\t\t\t\t\taudio: {\n\t\t\t\t\t\techoCancellation: true,\n\t\t\t\t\t\tnoiseSuppression: true,\n\t\t\t\t\t\tautoGainControl: true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tconsole.error('Error accessing media devices.', err);\n\t\t\ttoast.error($i18n.t('Error accessing media devices.'));\n\t\t\tloading = false;\n\t\t\trecording = false;\n\t\t\treturn;\n\t\t}\n\n\t\tconst mineTypes = ['audio/webm; codecs=opus', 'audio/mp4'];\n\n\t\tmediaRecorder = new MediaRecorder(stream, {\n\t\t\tmimeType: mineTypes.find((type) => MediaRecorder.isTypeSupported(type))\n\t\t});\n\n\t\tmediaRecorder.onstart = () => {\n\t\t\tconsole.log('Recording started');\n\t\t\tloading = false;\n\t\t\tstartDurationCounter();\n\n\t\t\taudioChunks = [];\n\t\t\tanalyseAudio(stream);\n\t\t};\n\t\tmediaRecorder.ondataavailable = (event) => audioChunks.push(event.data);\n\t\tmediaRecorder.onstop = async () => {\n\t\t\tconsole.log('Recording stopped');\n\n\t\t\tif (confirmed) {\n\t\t\t\t// Use the actual type provided by MediaRecorder\n\t\t\t\tlet type = audioChunks[0]?.type || mediaRecorder.mimeType || 'audio/webm';\n\n\t\t\t\t// split `/` and `;` to get the extension\n\t\t\t\tlet ext = type.split('/')[1].split(';')[0] || 'webm';\n\n\t\t\t\t// If not audio, default to audio/webm\n\t\t\t\tif (!type.startsWith('audio/')) {\n\t\t\t\t\text = 'webm';\n\t\t\t\t}\n\n\t\t\t\tconst audioBlob = new Blob(audioChunks, { type: type });\n\t\t\t\tawait onStopHandler(audioBlob, ext);\n\n\t\t\t\tconfirmed = false;\n\t\t\t\tloading = false;\n\t\t\t}\n\n\t\t\taudioChunks = [];\n\t\t\trecording = false;\n\t\t};\n\n\t\ttry {\n\t\t\tmediaRecorder.start();\n\t\t} catch (error) {\n\t\t\tconsole.error('Error starting recording:', error);\n\t\t\ttoast.error($i18n.t('Error starting recording.'));\n\t\t\tloading = false;\n\t\t\trecording = false;\n\t\t\treturn;\n\t\t}\n\n\t\tif (transcribe) {\n\t\t\tif ($config.audio.stt.engine === 'web' || ($settings?.audio?.stt?.engine ?? '') === 'web') {\n\t\t\t\tif ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {\n\t\t\t\t\t// Create a SpeechRecognition object\n\t\t\t\t\tspeechRecognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();\n\n\t\t\t\t\t// Set continuous to true for continuous recognition\n\t\t\t\t\tspeechRecognition.continuous = true;\n\n\t\t\t\t\t// Set the timeout for turning off the recognition after inactivity (in milliseconds)\n\t\t\t\t\tconst inactivityTimeout = 2000; // 3 seconds\n\n\t\t\t\t\tlet timeoutId;\n\t\t\t\t\t// Start recognition\n\t\t\t\t\tspeechRecognition.start();\n\n\t\t\t\t\t// Event triggered when speech is recognized\n\t\t\t\t\tspeechRecognition.onresult = async (event) => {\n\t\t\t\t\t\t// Clear the inactivity timeout\n\t\t\t\t\t\tclearTimeout(timeoutId);\n\n\t\t\t\t\t\t// Handle recognized speech\n\t\t\t\t\t\tconsole.log(event);\n\t\t\t\t\t\tconst transcript = event.results[Object.keys(event.results).length - 1][0].transcript;\n\n\t\t\t\t\t\ttranscription = `${transcription}${transcript}`;\n\n\t\t\t\t\t\tawait tick();\n\t\t\t\t\t\tdocument.getElementById('chat-input')?.focus();\n\n\t\t\t\t\t\t// Restart the inactivity timeout\n\t\t\t\t\t\ttimeoutId = setTimeout(() => {\n\t\t\t\t\t\t\tconsole.log('Speech recognition turned off due to inactivity.');\n\t\t\t\t\t\t\tspeechRecognition.stop();\n\t\t\t\t\t\t}, inactivityTimeout);\n\t\t\t\t\t};\n\n\t\t\t\t\t// Event triggered when recognition is ended\n\t\t\t\t\tspeechRecognition.onend = function () {\n\t\t\t\t\t\t// Restart recognition after it ends\n\t\t\t\t\t\tconsole.log('recognition ended');\n\n\t\t\t\t\t\tconfirmRecording();\n\t\t\t\t\t\tonConfirm({\n\t\t\t\t\t\t\ttext: transcription\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconfirmed = false;\n\t\t\t\t\t\tloading = false;\n\t\t\t\t\t};\n\n\t\t\t\t\t// Event triggered when an error occurs\n\t\t\t\t\tspeechRecognition.onerror = function (event) {\n\t\t\t\t\t\tconsole.log(event);\n\t\t\t\t\t\ttoast.error($i18n.t(`Speech recognition error: {{error}}`, { error: event.error }));\n\t\t\t\t\t\tonCancel();\n\n\t\t\t\t\t\tstopRecording();\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\tconst stopRecording = async () => {\n\t\tif (recording && mediaRecorder) {\n\t\t\tawait mediaRecorder.stop();\n\t\t}\n\n\t\tif (speechRecognition) {\n\t\t\tspeechRecognition.stop();\n\t\t}\n\n\t\tstopDurationCounter();\n\t\taudioChunks = [];\n\n\t\tif (stream) {\n\t\t\tconst tracks = stream.getTracks();\n\t\t\ttracks.forEach((track) => track.stop());\n\t\t}\n\n\t\tstream = null;\n\t};\n\n\tconst confirmRecording = async () => {\n\t\tloading = true;\n\t\tconfirmed = true;\n\n\t\tif (recording && mediaRecorder) {\n\t\t\tawait mediaRecorder.stop();\n\t\t}\n\t\tclearInterval(durationCounter);\n\n\t\tif (stream) {\n\t\t\tconst tracks = stream.getTracks();\n\t\t\ttracks.forEach((track) => track.stop());\n\t\t}\n\n\t\tstream = null;\n\t};\n\n\tlet resizeObserver;\n\tlet containerWidth;\n\n\tlet maxVisibleItems = 300;\n\t$: maxVisibleItems = Math.floor(containerWidth / 5); // 2px width + 0.5px gap\n\n\tonMount(() => {\n\t\t// listen to width changes\n\t\tresizeObserver = new ResizeObserver(() => {\n\t\t\tVISUALIZER_BUFFER_LENGTH = Math.floor(window.innerWidth / 4);\n\t\t\tif (visualizerData.length > VISUALIZER_BUFFER_LENGTH) {\n\t\t\t\tvisualizerData = visualizerData.slice(visualizerData.length - VISUALIZER_BUFFER_LENGTH);\n\t\t\t} else {\n\t\t\t\tvisualizerData = Array(VISUALIZER_BUFFER_LENGTH - visualizerData.length)\n\t\t\t\t\t.fill(0)\n\t\t\t\t\t.concat(visualizerData);\n\t\t\t}\n\t\t});\n\n\t\tresizeObserver.observe(document.body);\n\t});\n\n\tonDestroy(() => {\n\t\t// remove resize observer\n\t\tresizeObserver.disconnect();\n\t});\n</script>\n\n<div\n\tbind:clientWidth={containerWidth}\n\tclass=\"{loading\n\t\t? ' bg-gray-100/50 dark:bg-gray-850/50'\n\t\t: 'bg-indigo-300/10 dark:bg-indigo-500/10 '} rounded-full flex justify-between {className}\"\n>\n\t<div class=\"flex items-center mr-1\">\n\t\t<button\n\t\t\ttype=\"button\"\n\t\t\tclass=\"p-1.5\n\n            {loading\n\t\t\t\t? ' bg-gray-200 dark:bg-gray-700/50'\n\t\t\t\t: 'bg-indigo-400/20 text-indigo-600 dark:text-indigo-300 '} \n\n\n             rounded-full\"\n\t\t\ton:click={async () => {\n\t\t\t\tstopRecording();\n\t\t\t\tonCancel();\n\t\t\t}}\n\t\t>\n\t\t\t<svg\n\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\tfill=\"none\"\n\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\tstroke-width=\"3\"\n\t\t\t\tstroke=\"currentColor\"\n\t\t\t\tclass=\"size-4\"\n\t\t\t>\n\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M6 18 18 6M6 6l12 12\" />\n\t\t\t</svg>\n\t\t</button>\n\t</div>\n\n\t<div\n\t\tclass=\"flex flex-1 self-center items-center justify-between ml-2 mx-1 overflow-hidden h-6\"\n\t\tdir=\"rtl\"\n\t>\n\t\t<div\n\t\t\tclass=\"flex items-center gap-0.5 h-6 w-full max-w-full overflow-hidden overflow-x-hidden flex-wrap\"\n\t\t>\n\t\t\t{#each visualizerData.slice().reverse() as rms}\n\t\t\t\t<div class=\"flex items-center h-full\">\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"w-[2px] shrink-0\n                    \n                    {loading\n\t\t\t\t\t\t\t? ' bg-gray-500 dark:bg-gray-400   '\n\t\t\t\t\t\t\t: 'bg-indigo-500 dark:bg-indigo-400  '} \n                    \n                    inline-block h-full\"\n\t\t\t\t\t\tstyle=\"height: {Math.min(100, Math.max(14, rms * 100))}%;\"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t{/each}\n\t\t</div>\n\t</div>\n\n\t<div class=\"flex\">\n\t\t<div class=\"  mx-1.5 pr-1 flex justify-center items-center\">\n\t\t\t<div\n\t\t\t\tclass=\"text-sm\n        \n        \n        {loading ? ' text-gray-500  dark:text-gray-400  ' : ' text-indigo-400 '} \n       font-medium flex-1 mx-auto text-center\"\n\t\t\t>\n\t\t\t\t{formatSeconds(durationSeconds)}\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"flex items-center\">\n\t\t\t{#if loading}\n\t\t\t\t<div class=\" text-gray-500 rounded-full cursor-not-allowed\">\n\t\t\t\t\t<svg\n\t\t\t\t\t\twidth=\"24\"\n\t\t\t\t\t\theight=\"24\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\t\t><style>\n\t\t\t\t\t\t\t.spinner_OSmW {\n\t\t\t\t\t\t\t\ttransform-origin: center;\n\t\t\t\t\t\t\t\tanimation: spinner_T6mA 0.75s step-end infinite;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t@keyframes spinner_T6mA {\n\t\t\t\t\t\t\t\t8.3% {\n\t\t\t\t\t\t\t\t\ttransform: rotate(30deg);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t16.6% {\n\t\t\t\t\t\t\t\t\ttransform: rotate(60deg);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t25% {\n\t\t\t\t\t\t\t\t\ttransform: rotate(90deg);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t33.3% {\n\t\t\t\t\t\t\t\t\ttransform: rotate(120deg);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t41.6% {\n\t\t\t\t\t\t\t\t\ttransform: rotate(150deg);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t50% {\n\t\t\t\t\t\t\t\t\ttransform: rotate(180deg);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t58.3% {\n\t\t\t\t\t\t\t\t\ttransform: rotate(210deg);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t66.6% {\n\t\t\t\t\t\t\t\t\ttransform: rotate(240deg);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t75% {\n\t\t\t\t\t\t\t\t\ttransform: rotate(270deg);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t83.3% {\n\t\t\t\t\t\t\t\t\ttransform: rotate(300deg);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t91.6% {\n\t\t\t\t\t\t\t\t\ttransform: rotate(330deg);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t100% {\n\t\t\t\t\t\t\t\t\ttransform: rotate(360deg);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</style><g class=\"spinner_OSmW\"\n\t\t\t\t\t\t\t><rect x=\"11\" y=\"1\" width=\"2\" height=\"5\" opacity=\".14\" /><rect\n\t\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\t\ttransform=\"rotate(30 12 12)\"\n\t\t\t\t\t\t\t\topacity=\".29\"\n\t\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\t\ttransform=\"rotate(60 12 12)\"\n\t\t\t\t\t\t\t\topacity=\".43\"\n\t\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\t\ttransform=\"rotate(90 12 12)\"\n\t\t\t\t\t\t\t\topacity=\".57\"\n\t\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\t\ttransform=\"rotate(120 12 12)\"\n\t\t\t\t\t\t\t\topacity=\".71\"\n\t\t\t\t\t\t\t/><rect\n\t\t\t\t\t\t\t\tx=\"11\"\n\t\t\t\t\t\t\t\ty=\"1\"\n\t\t\t\t\t\t\t\twidth=\"2\"\n\t\t\t\t\t\t\t\theight=\"5\"\n\t\t\t\t\t\t\t\ttransform=\"rotate(150 12 12)\"\n\t\t\t\t\t\t\t\topacity=\".86\"\n\t\t\t\t\t\t\t/><rect x=\"11\" y=\"1\" width=\"2\" height=\"5\" transform=\"rotate(180 12 12)\" /></g\n\t\t\t\t\t\t></svg\n\t\t\t\t\t>\n\t\t\t\t</div>\n\t\t\t{:else}\n\t\t\t\t<button\n\t\t\t\t\ttype=\"button\"\n\t\t\t\t\tclass=\"p-1.5 bg-indigo-500 text-white dark:bg-indigo-500 dark:text-blue-950 rounded-full\"\n\t\t\t\t\ton:click={async () => {\n\t\t\t\t\t\tawait confirmRecording();\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<svg\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\t\tfill=\"none\"\n\t\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\t\tstroke-width=\"2.5\"\n\t\t\t\t\t\tstroke=\"currentColor\"\n\t\t\t\t\t\tclass=\"size-4\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"m4.5 12.75 6 6 9-13.5\" />\n\t\t\t\t\t</svg>\n\t\t\t\t</button>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n</div>\n\n<style>\n\t.visualizer {\n\t\tdisplay: flex;\n\t\theight: 100%;\n\t}\n\n\t.visualizer-bar {\n\t\twidth: 2px;\n\t\tbackground-color: #4a5aba; /* or whatever color you need */\n\t}\n</style>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { getContext, onMount } from 'svelte';\n\n\timport { flyAndScale } from '$lib/utils/transitions';\n\timport { fade, slide } from 'svelte/transition';\n\n\timport { showSettings, activeUserIds, USAGE_POOL, mobile, showSidebar, user } from '$lib/stores';\n\n\timport Tooltip from '$lib/components/common/Tooltip.svelte';\n\timport ArchiveBox from '$lib/components/icons/ArchiveBox.svelte';\n\timport Download from '$lib/components/icons/Download.svelte';\n\timport GarbageBin from '$lib/components/icons/GarbageBin.svelte';\n\timport DocumentDuplicate from '$lib/components/icons/DocumentDuplicate.svelte';\n\timport Share from '$lib/components/icons/Share.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let show = false;\n\texport let className = 'max-w-[180px]';\n\n\texport let onDownload = (type) => {};\n\texport let onDelete = () => {};\n\texport let onCopyToClipboard = () => {};\n\n\texport let onChange = () => {};\n</script>\n\n<DropdownMenu.Root\n\tbind:open={show}\n\tonOpenChange={(state) => {\n\t\tonChange(state);\n\t}}\n>\n\t<DropdownMenu.Trigger>\n\t\t<slot />\n\t</DropdownMenu.Trigger>\n\n\t<slot name=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full {className} text-sm rounded-xl px-1 py-1.5 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg font-primary\"\n\t\t\tsideOffset={6}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"start\"\n\t\t\ttransition={(e) => fade(e, { duration: 100 })}\n\t\t>\n\t\t\t<DropdownMenu.Sub>\n\t\t\t\t<DropdownMenu.SubTrigger\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t>\n\t\t\t\t\t<Download strokeWidth=\"2\" />\n\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Download')}</div>\n\t\t\t\t</DropdownMenu.SubTrigger>\n\t\t\t\t<DropdownMenu.SubContent\n\t\t\t\t\tclass=\"w-full rounded-xl px-1 py-1.5 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\n\t\t\t\t\ttransition={flyAndScale}\n\t\t\t\t\tsideOffset={8}\n\t\t\t\t>\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tonDownload('md');\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('Plain text (.md)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tonDownload('pdf');\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<div class=\"flex items-center line-clamp-1\">{$i18n.t('PDF document (.pdf)')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t</DropdownMenu.SubContent>\n\t\t\t</DropdownMenu.Sub>\n\n\t\t\t<DropdownMenu.Sub>\n\t\t\t\t<DropdownMenu.SubTrigger\n\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t>\n\t\t\t\t\t<Share strokeWidth=\"2\" />\n\n\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Share')}</div>\n\t\t\t\t</DropdownMenu.SubTrigger>\n\t\t\t\t<DropdownMenu.SubContent\n\t\t\t\t\tclass=\"w-full rounded-xl px-1 py-1.5 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg\"\n\t\t\t\t\ttransition={flyAndScale}\n\t\t\t\t\tsideOffset={8}\n\t\t\t\t>\n\t\t\t\t\t<DropdownMenu.Item\n\t\t\t\t\t\tclass=\"flex gap-2 items-center px-3 py-2 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tonCopyToClipboard();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<DocumentDuplicate strokeWidth=\"2\" />\n\t\t\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Copy to clipboard')}</div>\n\t\t\t\t\t</DropdownMenu.Item>\n\t\t\t\t</DropdownMenu.SubContent>\n\t\t\t</DropdownMenu.Sub>\n\n\t\t\t<DropdownMenu.Item\n\t\t\t\tclass=\"flex  gap-2  items-center px-3 py-1.5 text-sm  cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 rounded-md\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tonDelete();\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<GarbageBin strokeWidth=\"2\" />\n\t\t\t\t<div class=\"flex items-center\">{$i18n.t('Delete')}</div>\n\t\t\t</DropdownMenu.Item>\n\t\t</DropdownMenu.Content>\n\t</slot>\n</DropdownMenu.Root>\n","<script lang=\"ts\">\n\texport let className = 'size-3';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-3';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M15.042 21.672 13.684 16.6m0 0-2.51 2.225.569-9.47 5.227 7.917-3.286-.672ZM12 2.25V4.5m5.834.166-1.591 1.591M20.25 10.5H18M7.757 14.743l-1.59 1.59M6 10.5H3.75m4.007-4.243-1.59-1.59\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { DropdownMenu } from 'bits-ui';\n\timport { createEventDispatcher, getContext, onMount } from 'svelte';\n\n\timport { showSettings, activeUserIds, USAGE_POOL, mobile, showSidebar, user } from '$lib/stores';\n\timport { fade, slide } from 'svelte/transition';\n\n\timport Mic from '../icons/Mic.svelte';\n\timport CursorArrowRays from '../icons/CursorArrowRays.svelte';\n\timport DocumentArrowUp from '../icons/DocumentArrowUp.svelte';\n\timport CloudArrowUp from '../icons/CloudArrowUp.svelte';\n\n\tconst i18n = getContext('i18n');\n\n\texport let show = false;\n\texport let className = 'max-w-[170px]';\n\n\texport let onRecord = () => {};\n\texport let onCaptureAudio = () => {};\n\texport let onUpload = () => {};\n\n\tconst dispatch = createEventDispatcher();\n</script>\n\n<DropdownMenu.Root\n\tbind:open={show}\n\tonOpenChange={(state) => {\n\t\tdispatch('change', state);\n\t}}\n>\n\t<DropdownMenu.Trigger>\n\t\t<slot />\n\t</DropdownMenu.Trigger>\n\n\t<slot name=\"content\">\n\t\t<DropdownMenu.Content\n\t\t\tclass=\"w-full {className} text-sm rounded-xl px-1 py-1.5 z-50 bg-white dark:bg-gray-850 dark:text-white shadow-lg font-primary\"\n\t\t\tsideOffset={8}\n\t\t\tside=\"bottom\"\n\t\t\talign=\"start\"\n\t\t\ttransition={(e) => fade(e, { duration: 100 })}\n\t\t>\n\t\t\t<button\n\t\t\t\tclass=\"flex rounded-md py-1.5 px-3 w-full hover:bg-gray-50 dark:hover:bg-gray-800 transition\"\n\t\t\t\ton:click={async () => {\n\t\t\t\t\tonRecord();\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\" self-center mr-2\">\n\t\t\t\t\t<Mic className=\"size-5\" strokeWidth=\"1.5\" />\n\t\t\t\t</div>\n\t\t\t\t<div class=\" self-center truncate\">{$i18n.t('Record')}</div>\n\t\t\t</button>\n\n\t\t\t<button\n\t\t\t\tclass=\"flex rounded-md py-1.5 px-3 w-full hover:bg-gray-50 dark:hover:bg-gray-800 transition\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tonCaptureAudio();\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\" self-center mr-2\">\n\t\t\t\t\t<CursorArrowRays className=\"size-5\" strokeWidth=\"1.5\" />\n\t\t\t\t</div>\n\t\t\t\t<div class=\" self-center truncate\">{$i18n.t('Capture Audio')}</div>\n\t\t\t</button>\n\n\t\t\t<button\n\t\t\t\tclass=\"flex rounded-md py-1.5 px-3 w-full hover:bg-gray-50 dark:hover:bg-gray-800 transition\"\n\t\t\t\ton:click={() => {\n\t\t\t\t\tonUpload();\n\t\t\t\t\tshow = false;\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<div class=\" self-center mr-2\">\n\t\t\t\t\t<CloudArrowUp className=\"size-5\" strokeWidth=\"1.5\" />\n\t\t\t\t</div>\n\t\t\t\t<div class=\" self-center truncate\">{$i18n.t('Upload Audio')}</div>\n\t\t\t</button>\n\t\t</DropdownMenu.Content>\n\t</slot>\n</DropdownMenu.Root>\n","<script lang=\"ts\">\n\texport let className = 'w-4 h-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"currentColor\" class={className}>\n\t<path\n\t\tfill-rule=\"evenodd\"\n\t\td=\"M9 4.5a.75.75 0 0 1 .721.544l.813 2.846a3.75 3.75 0 0 0 2.576 2.576l2.846.813a.75.75 0 0 1 0 1.442l-2.846.813a3.75 3.75 0 0 0-2.576 2.576l-.813 2.846a.75.75 0 0 1-1.442 0l-.813-2.846a3.75 3.75 0 0 0-2.576-2.576l-2.846-.813a.75.75 0 0 1 0-1.442l2.846-.813A3.75 3.75 0 0 0 7.466 7.89l.813-2.846A.75.75 0 0 1 9 4.5ZM18 1.5a.75.75 0 0 1 .728.568l.258 1.036c.236.94.97 1.674 1.91 1.91l1.036.258a.75.75 0 0 1 0 1.456l-1.036.258c-.94.236-1.674.97-1.91 1.91l-.258 1.036a.75.75 0 0 1-1.456 0l-.258-1.036a2.625 2.625 0 0 0-1.91-1.91l-1.036-.258a.75.75 0 0 1 0-1.456l1.036-.258a2.625 2.625 0 0 0 1.91-1.91l.258-1.036A.75.75 0 0 1 18 1.5ZM16.5 15a.75.75 0 0 1 .712.513l.394 1.183c.15.447.5.799.948.948l1.183.395a.75.75 0 0 1 0 1.422l-1.183.395c-.447.15-.799.5-.948.948l-.395 1.183a.75.75 0 0 1-1.422 0l-.395-1.183a1.5 1.5 0 0 0-.948-.948l-1.183-.395a.75.75 0 0 1 0-1.422l1.183-.395c.447-.15.799-.5.948-.948l.395-1.183A.75.75 0 0 1 16.5 15Z\"\n\t\tclip-rule=\"evenodd\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"M9 15 3 9m0 0 6-6M3 9h12a6 6 0 0 1 0 12h-3\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\texport let className = 'size-4';\n\texport let strokeWidth = '1.5';\n</script>\n\n<svg\n\txmlns=\"http://www.w3.org/2000/svg\"\n\tfill=\"none\"\n\tviewBox=\"0 0 24 24\"\n\tstroke-width={strokeWidth}\n\tstroke=\"currentColor\"\n\tclass={className}\n>\n\t<path\n\t\tstroke-linecap=\"round\"\n\t\tstroke-linejoin=\"round\"\n\t\td=\"m15 15 6-6m0 0-6-6m6 6H9a6 6 0 0 0 0 12h3\"\n\t/>\n</svg>\n","<script lang=\"ts\">\n\timport { getContext, onDestroy, onMount, tick } from 'svelte';\n\timport { v4 as uuidv4 } from 'uuid';\n\timport fileSaver from 'file-saver';\n\tconst { saveAs } = fileSaver;\n\n\timport jsPDF from 'jspdf';\n\timport html2canvas from 'html2canvas-pro';\n\n\tconst i18n = getContext('i18n');\n\n\timport { marked } from 'marked';\n\timport { toast } from 'svelte-sonner';\n\n\timport { config, models, settings, showSidebar } from '$lib/stores';\n\timport { goto } from '$app/navigation';\n\n\timport { compressImage, copyToClipboard, splitStream } from '$lib/utils';\n\timport { WEBUI_API_BASE_URL, WEBUI_BASE_URL } from '$lib/constants';\n\timport { uploadFile } from '$lib/apis/files';\n\n\timport dayjs from '$lib/dayjs';\n\timport calendar from 'dayjs/plugin/calendar';\n\timport duration from 'dayjs/plugin/duration';\n\timport relativeTime from 'dayjs/plugin/relativeTime';\n\n\tdayjs.extend(calendar);\n\tdayjs.extend(duration);\n\tdayjs.extend(relativeTime);\n\n\tasync function loadLocale(locales) {\n\t\tfor (const locale of locales) {\n\t\t\ttry {\n\t\t\t\tdayjs.locale(locale);\n\t\t\t\tbreak; // Stop after successfully loading the first available locale\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(`Could not load locale '${locale}':`, error);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Assuming $i18n.languages is an array of language codes\n\t$: loadLocale($i18n.languages);\n\n\timport { deleteNoteById, getNoteById, updateNoteById } from '$lib/apis/notes';\n\n\timport RichTextInput from '../common/RichTextInput.svelte';\n\timport Spinner from '../common/Spinner.svelte';\n\timport MicSolid from '../icons/MicSolid.svelte';\n\timport VoiceRecording from '../chat/MessageInput/VoiceRecording.svelte';\n\timport DeleteConfirmDialog from '$lib/components/common/ConfirmDialog.svelte';\n\n\timport Calendar from '../icons/Calendar.svelte';\n\timport Users from '../icons/Users.svelte';\n\n\timport Image from '../common/Image.svelte';\n\timport FileItem from '../common/FileItem.svelte';\n\timport FilesOverlay from '../chat/MessageInput/FilesOverlay.svelte';\n\timport RecordMenu from './RecordMenu.svelte';\n\timport NoteMenu from './Notes/NoteMenu.svelte';\n\timport EllipsisHorizontal from '../icons/EllipsisHorizontal.svelte';\n\timport Sparkles from '../icons/Sparkles.svelte';\n\timport SparklesSolid from '../icons/SparklesSolid.svelte';\n\timport Tooltip from '../common/Tooltip.svelte';\n\timport Bars3BottomLeft from '../icons/Bars3BottomLeft.svelte';\n\timport ArrowUturnLeft from '../icons/ArrowUturnLeft.svelte';\n\timport ArrowUturnRight from '../icons/ArrowUturnRight.svelte';\n\timport Sidebar from '../common/Sidebar.svelte';\n\timport ArrowRight from '../icons/ArrowRight.svelte';\n\timport Cog6 from '../icons/Cog6.svelte';\n\timport { chatCompletion } from '$lib/apis/openai';\n\n\texport let id: null | string = null;\n\n\tlet note = null;\n\n\tconst newNote = {\n\t\ttitle: '',\n\t\tdata: {\n\t\t\tcontent: {\n\t\t\t\tjson: null,\n\t\t\t\thtml: '',\n\t\t\t\tmd: ''\n\t\t\t},\n\t\t\tversions: [],\n\t\t\tfiles: null\n\t\t},\n\t\tmeta: null,\n\t\taccess_control: null\n\t};\n\n\tlet files = [];\n\n\tlet versionIdx = null;\n\tlet selectedModelId = null;\n\n\tlet recording = false;\n\tlet displayMediaRecord = false;\n\n\tlet showSettings = false;\n\tlet showDeleteConfirm = false;\n\n\tlet dragged = false;\n\tlet loading = false;\n\n\tlet enhancing = false;\n\tlet streaming = false;\n\n\tconst init = async () => {\n\t\tloading = true;\n\t\tconst res = await getNoteById(localStorage.token, id).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\tnote = res;\n\t\t\tfiles = res.data.files || [];\n\t\t} else {\n\t\t\tgoto('/');\n\t\t\treturn;\n\t\t}\n\n\t\tloading = false;\n\t};\n\n\tlet debounceTimeout: NodeJS.Timeout | null = null;\n\n\tconst changeDebounceHandler = () => {\n\t\tif (debounceTimeout) {\n\t\t\tclearTimeout(debounceTimeout);\n\t\t}\n\n\t\tdebounceTimeout = setTimeout(async () => {\n\t\t\tif (!note || enhancing || versionIdx !== null) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconsole.log('Saving note:', note);\n\n\t\t\tconst res = await updateNoteById(localStorage.token, id, {\n\t\t\t\t...note,\n\t\t\t\ttitle: note.title === '' ? $i18n.t('Untitled') : note.title\n\t\t\t}).catch((e) => {\n\t\t\t\ttoast.error(`${e}`);\n\t\t\t});\n\t\t}, 200);\n\t};\n\n\t$: if (note) {\n\t\tchangeDebounceHandler();\n\t}\n\n\t$: if (id) {\n\t\tinit();\n\t}\n\n\tfunction areContentsEqual(a, b) {\n\t\treturn JSON.stringify(a) === JSON.stringify(b);\n\t}\n\n\tfunction insertNoteVersion(note) {\n\t\tconst current = {\n\t\t\tjson: note.data.content.json,\n\t\t\thtml: note.data.content.html,\n\t\t\tmd: note.data.content.md\n\t\t};\n\t\tconst lastVersion = note.data.versions?.at(-1);\n\n\t\tif (!lastVersion || !areContentsEqual(lastVersion, current)) {\n\t\t\tnote.data.versions = (note.data.versions ?? []).concat(current);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tasync function enhanceNoteHandler() {\n\t\tif (selectedModelId === '') {\n\t\t\ttoast.error($i18n.t('Please select a model.'));\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = $models\n\t\t\t.filter((model) => model.id === selectedModelId && !(model?.info?.meta?.hidden ?? false))\n\t\t\t.find((model) => model.id === selectedModelId);\n\n\t\tif (!model) {\n\t\t\tselectedModelId = '';\n\t\t\treturn;\n\t\t}\n\n\t\tenhancing = true;\n\n\t\tinsertNoteVersion(note);\n\t\tawait enhanceCompletionHandler(model);\n\n\t\tenhancing = false;\n\t\tversionIdx = null;\n\t}\n\n\tfunction setContentByVersion(versionIdx) {\n\t\tif (!note.data.versions?.length) return;\n\t\tlet idx = versionIdx;\n\n\t\tif (idx === null) idx = note.data.versions.length - 1; // latest\n\t\tconst v = note.data.versions[idx];\n\n\t\tnote.data.content.json = v.json;\n\t\tnote.data.content.html = v.html;\n\t\tnote.data.content.md = v.md;\n\n\t\tif (versionIdx === null) {\n\t\t\tconst lastVersion = note.data.versions.at(-1);\n\t\t\tconst currentContent = note.data.content;\n\n\t\t\tif (areContentsEqual(lastVersion, currentContent)) {\n\t\t\t\t// remove the last version\n\t\t\t\tnote.data.versions = note.data.versions.slice(0, -1);\n\t\t\t}\n\t\t}\n\t}\n\n\t// Navigation\n\tfunction versionNavigateHandler(direction) {\n\t\tif (!note.data.versions || note.data.versions.length === 0) return;\n\n\t\tif (versionIdx === null) {\n\t\t\t// Get latest snapshots\n\t\t\tconst lastVersion = note.data.versions.at(-1);\n\t\t\tconst currentContent = note.data.content;\n\n\t\t\tif (!areContentsEqual(lastVersion, currentContent)) {\n\t\t\t\t// If the current content is different from the last version, insert a new version\n\t\t\t\tinsertNoteVersion(note);\n\t\t\t\tversionIdx = note.data.versions.length - 1;\n\t\t\t} else {\n\t\t\t\tversionIdx = note.data.versions.length;\n\t\t\t}\n\t\t}\n\n\t\tif (direction === 'prev') {\n\t\t\tif (versionIdx > 0) versionIdx -= 1;\n\t\t} else if (direction === 'next') {\n\t\t\tif (versionIdx < note.data.versions.length - 1) versionIdx += 1;\n\t\t\telse versionIdx = null; // Reset to latest\n\n\t\t\tif (versionIdx === note.data.versions.length - 1) {\n\t\t\t\t// If we reach the latest version, reset to null\n\t\t\t\tversionIdx = null;\n\t\t\t}\n\t\t}\n\n\t\tsetContentByVersion(versionIdx);\n\t}\n\n\tconst uploadFileHandler = async (file) => {\n\t\tconst tempItemId = uuidv4();\n\t\tconst fileItem = {\n\t\t\ttype: 'file',\n\t\t\tfile: '',\n\t\t\tid: null,\n\t\t\turl: '',\n\t\t\tname: file.name,\n\t\t\tcollection_name: '',\n\t\t\tstatus: 'uploading',\n\t\t\tsize: file.size,\n\t\t\terror: '',\n\t\t\titemId: tempItemId\n\t\t};\n\n\t\tif (fileItem.size == 0) {\n\t\t\ttoast.error($i18n.t('You cannot upload an empty file.'));\n\t\t\treturn null;\n\t\t}\n\n\t\tfiles = [...files, fileItem];\n\n\t\ttry {\n\t\t\t// If the file is an audio file, provide the language for STT.\n\t\t\tlet metadata = null;\n\t\t\tif (\n\t\t\t\t(file.type.startsWith('audio/') || file.type.startsWith('video/')) &&\n\t\t\t\t$settings?.audio?.stt?.language\n\t\t\t) {\n\t\t\t\tmetadata = {\n\t\t\t\t\tlanguage: $settings?.audio?.stt?.language\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// During the file upload, file content is automatically extracted.\n\t\t\tconst uploadedFile = await uploadFile(localStorage.token, file, metadata);\n\n\t\t\tif (uploadedFile) {\n\t\t\t\tconsole.log('File upload completed:', {\n\t\t\t\t\tid: uploadedFile.id,\n\t\t\t\t\tname: fileItem.name,\n\t\t\t\t\tcollection: uploadedFile?.meta?.collection_name\n\t\t\t\t});\n\n\t\t\t\tif (uploadedFile.error) {\n\t\t\t\t\tconsole.warn('File upload warning:', uploadedFile.error);\n\t\t\t\t\ttoast.warning(uploadedFile.error);\n\t\t\t\t}\n\n\t\t\t\tfileItem.status = 'uploaded';\n\t\t\t\tfileItem.file = uploadedFile;\n\t\t\t\tfileItem.id = uploadedFile.id;\n\t\t\t\tfileItem.collection_name =\n\t\t\t\t\tuploadedFile?.meta?.collection_name || uploadedFile?.collection_name;\n\n\t\t\t\tfileItem.url = `${WEBUI_API_BASE_URL}/files/${uploadedFile.id}`;\n\n\t\t\t\tfiles = files;\n\t\t\t} else {\n\t\t\t\tfiles = files.filter((item) => item?.itemId !== tempItemId);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\ttoast.error(`${e}`);\n\t\t\tfiles = files.filter((item) => item?.itemId !== tempItemId);\n\t\t}\n\n\t\tif (files.length > 0) {\n\t\t\tnote.data.files = files;\n\t\t} else {\n\t\t\tnote.data.files = null;\n\t\t}\n\t};\n\n\tconst inputFilesHandler = async (inputFiles) => {\n\t\tconsole.log('Input files handler called with:', inputFiles);\n\t\tinputFiles.forEach((file) => {\n\t\t\tconsole.log('Processing file:', {\n\t\t\t\tname: file.name,\n\t\t\t\ttype: file.type,\n\t\t\t\tsize: file.size,\n\t\t\t\textension: file.name.split('.').at(-1)\n\t\t\t});\n\n\t\t\tif (\n\t\t\t\t($config?.file?.max_size ?? null) !== null &&\n\t\t\t\tfile.size > ($config?.file?.max_size ?? 0) * 1024 * 1024\n\t\t\t) {\n\t\t\t\tconsole.log('File exceeds max size limit:', {\n\t\t\t\t\tfileSize: file.size,\n\t\t\t\t\tmaxSize: ($config?.file?.max_size ?? 0) * 1024 * 1024\n\t\t\t\t});\n\t\t\t\ttoast.error(\n\t\t\t\t\t$i18n.t(`File size should not exceed {{maxSize}} MB.`, {\n\t\t\t\t\t\tmaxSize: $config?.file?.max_size\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\t['image/gif', 'image/webp', 'image/jpeg', 'image/png', 'image/avif'].includes(file['type'])\n\t\t\t) {\n\t\t\t\tlet reader = new FileReader();\n\t\t\t\treader.onload = async (event) => {\n\t\t\t\t\tlet imageUrl = event.target.result;\n\n\t\t\t\t\tif ($settings?.imageCompression ?? false) {\n\t\t\t\t\t\tconst width = $settings?.imageCompressionSize?.width ?? null;\n\t\t\t\t\t\tconst height = $settings?.imageCompressionSize?.height ?? null;\n\n\t\t\t\t\t\tif (width || height) {\n\t\t\t\t\t\t\timageUrl = await compressImage(imageUrl, width, height);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfiles = [\n\t\t\t\t\t\t...files,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'image',\n\t\t\t\t\t\t\turl: `${imageUrl}`\n\t\t\t\t\t\t}\n\t\t\t\t\t];\n\t\t\t\t\tnote.data.files = files;\n\t\t\t\t};\n\t\t\t\treader.readAsDataURL(file);\n\t\t\t} else {\n\t\t\t\tuploadFileHandler(file);\n\t\t\t}\n\t\t});\n\t};\n\n\tconst downloadHandler = async (type) => {\n\t\tconsole.log('downloadHandler', type);\n\t\tif (type === 'md') {\n\t\t\tconst blob = new Blob([note.data.content.md], { type: 'text/markdown' });\n\t\t\tsaveAs(blob, `${note.title}.md`);\n\t\t} else if (type === 'pdf') {\n\t\t\tawait downloadPdf(note);\n\t\t}\n\t};\n\n\tconst downloadPdf = async (note) => {\n\t\ttry {\n\t\t\t// Define a fixed virtual screen size\n\t\t\tconst virtualWidth = 1024; // Fixed width (adjust as needed)\n\t\t\tconst virtualHeight = 1400; // Fixed height (adjust as needed)\n\n\t\t\t// STEP 1. Get a DOM node to render\n\t\t\tconst html = note.data?.content?.html ?? '';\n\t\t\tlet node;\n\t\t\tif (html instanceof HTMLElement) {\n\t\t\t\tnode = html;\n\t\t\t} else {\n\t\t\t\t// If it's HTML string, render to a temporary hidden element\n\t\t\t\tnode = document.createElement('div');\n\t\t\t\tnode.innerHTML = html;\n\t\t\t\tdocument.body.appendChild(node);\n\t\t\t}\n\n\t\t\t// Render to canvas with predefined width\n\t\t\tconst canvas = await html2canvas(node, {\n\t\t\t\tuseCORS: true,\n\t\t\t\tscale: 2, // Keep at 1x to avoid unexpected enlargements\n\t\t\t\twidth: virtualWidth, // Set fixed virtual screen width\n\t\t\t\twindowWidth: virtualWidth, // Ensure consistent rendering\n\t\t\t\twindowHeight: virtualHeight\n\t\t\t});\n\n\t\t\t// Remove hidden node if needed\n\t\t\tif (!(html instanceof HTMLElement)) {\n\t\t\t\tdocument.body.removeChild(node);\n\t\t\t}\n\n\t\t\tconst imgData = canvas.toDataURL('image/png');\n\n\t\t\t// A4 page settings\n\t\t\tconst pdf = new jsPDF('p', 'mm', 'a4');\n\t\t\tconst imgWidth = 210; // A4 width in mm\n\t\t\tconst pageHeight = 297; // A4 height in mm\n\n\t\t\t// Maintain aspect ratio\n\t\t\tconst imgHeight = (canvas.height * imgWidth) / canvas.width;\n\t\t\tlet heightLeft = imgHeight;\n\t\t\tlet position = 0;\n\n\t\t\tpdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n\t\t\theightLeft -= pageHeight;\n\n\t\t\t// Handle additional pages\n\t\t\twhile (heightLeft > 0) {\n\t\t\t\tposition -= pageHeight;\n\t\t\t\tpdf.addPage();\n\n\t\t\t\tpdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);\n\t\t\t\theightLeft -= pageHeight;\n\t\t\t}\n\n\t\t\tpdf.save(`${note.title}.pdf`);\n\t\t} catch (error) {\n\t\t\tconsole.error('Error generating PDF', error);\n\n\t\t\ttoast.error(`${error}`);\n\t\t}\n\t};\n\n\tconst deleteNoteHandler = async (id) => {\n\t\tconst res = await deleteNoteById(localStorage.token, id).catch((error) => {\n\t\t\ttoast.error(`${error}`);\n\t\t\treturn null;\n\t\t});\n\n\t\tif (res) {\n\t\t\ttoast.success($i18n.t('Note deleted successfully'));\n\t\t\tgoto('/notes');\n\t\t} else {\n\t\t\ttoast.error($i18n.t('Failed to delete note'));\n\t\t}\n\t};\n\n\tconst scrollToBottom = () => {\n\t\tconst element = document.getElementById('note-content-container');\n\n\t\tif (element) {\n\t\t\telement.scrollTop = element?.scrollHeight;\n\t\t}\n\t};\n\n\tconst enhanceCompletionHandler = async (model) => {\n\t\tlet enhancedContent = {\n\t\t\tjson: null,\n\t\t\thtml: '',\n\t\t\tmd: ''\n\t\t};\n\n\t\tconst systemPrompt = `Enhance existing notes using additional context provided from audio transcription or uploaded file content. Your task is to make the notes more useful and comprehensive by incorporating relevant information from the provided context.\n\nInput will be provided within <notes> and <context> XML tags, providing a structure for the existing notes and context respectively.\n\n# Output Format\n\nProvide the enhanced notes in markdown format. Use markdown syntax for headings, lists, and emphasis to improve clarity and presentation. Ensure that all integrated content from the context is accurately reflected. Return only the markdown formatted note.\n`;\n\n\t\tconst [res, controller] = await chatCompletion(\n\t\t\tlocalStorage.token,\n\t\t\t{\n\t\t\t\tmodel: model.id,\n\t\t\t\tstream: true,\n\t\t\t\tmessages: [\n\t\t\t\t\t{\n\t\t\t\t\t\trole: 'system',\n\t\t\t\t\t\tcontent: systemPrompt\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\trole: 'user',\n\t\t\t\t\t\tcontent:\n\t\t\t\t\t\t\t`<notes>${note.data.content.md}</notes>` +\n\t\t\t\t\t\t\t(files && files.length > 0\n\t\t\t\t\t\t\t\t? `\\n<context>${files.map((file) => `${file.name}: ${file?.file?.data?.content ?? 'Could not extract content'}\\n`).join('')}</context>`\n\t\t\t\t\t\t\t\t: '')\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t},\n\t\t\t`${WEBUI_BASE_URL}/api`\n\t\t);\n\n\t\tawait tick();\n\n\t\tstreaming = true;\n\n\t\tif (res && res.ok) {\n\t\t\tconst reader = res.body\n\t\t\t\t.pipeThrough(new TextDecoderStream())\n\t\t\t\t.pipeThrough(splitStream('\\n'))\n\t\t\t\t.getReader();\n\n\t\t\twhile (true) {\n\t\t\t\tconst { value, done } = await reader.read();\n\t\t\t\tif (done) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\ttry {\n\t\t\t\t\tlet lines = value.split('\\n');\n\n\t\t\t\t\tfor (const line of lines) {\n\t\t\t\t\t\tif (line !== '') {\n\t\t\t\t\t\t\tconsole.log(line);\n\t\t\t\t\t\t\tif (line === 'data: [DONE]') {\n\t\t\t\t\t\t\t\tconsole.log(line);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlet data = JSON.parse(line.replace(/^data: /, ''));\n\t\t\t\t\t\t\t\tconsole.log(data);\n\n\t\t\t\t\t\t\t\tif (data.choices && data.choices.length > 0) {\n\t\t\t\t\t\t\t\t\tconst choice = data.choices[0];\n\t\t\t\t\t\t\t\t\tif (choice.delta && choice.delta.content) {\n\t\t\t\t\t\t\t\t\t\tenhancedContent.md += choice.delta.content;\n\t\t\t\t\t\t\t\t\t\tenhancedContent.html = marked.parse(enhancedContent.md);\n\n\t\t\t\t\t\t\t\t\t\tnote.data.content.md = enhancedContent.md;\n\t\t\t\t\t\t\t\t\t\tnote.data.content.html = enhancedContent.html;\n\t\t\t\t\t\t\t\t\t\tnote.data.content.json = null;\n\n\t\t\t\t\t\t\t\t\t\tscrollToBottom();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tconsole.log(error);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tstreaming = false;\n\t};\n\n\tconst onDragOver = (e) => {\n\t\te.preventDefault();\n\n\t\t// Check if a file is being dragged.\n\t\tif (e.dataTransfer?.types?.includes('Files')) {\n\t\t\tdragged = true;\n\t\t} else {\n\t\t\tdragged = false;\n\t\t}\n\t};\n\n\tconst onDragLeave = () => {\n\t\tdragged = false;\n\t};\n\n\tconst onDrop = async (e) => {\n\t\te.preventDefault();\n\t\tconsole.log(e);\n\n\t\tif (e.dataTransfer?.files) {\n\t\t\tconst inputFiles = Array.from(e.dataTransfer?.files);\n\t\t\tif (inputFiles && inputFiles.length > 0) {\n\t\t\t\tconsole.log(inputFiles);\n\t\t\t\tinputFilesHandler(inputFiles);\n\t\t\t}\n\t\t}\n\n\t\tdragged = false;\n\t};\n\n\tonMount(async () => {\n\t\tawait tick();\n\n\t\tif ($settings?.models) {\n\t\t\tselectedModelId = $settings?.models[0];\n\t\t} else if ($config?.default_models) {\n\t\t\tselectedModelId = $config?.default_models.split(',')[0];\n\t\t} else {\n\t\t\tselectedModelId = '';\n\t\t}\n\n\t\tif (selectedModelId) {\n\t\t\tconst model = $models\n\t\t\t\t.filter((model) => model.id === selectedModelId && !(model?.info?.meta?.hidden ?? false))\n\t\t\t\t.find((model) => model.id === selectedModelId);\n\n\t\t\tif (!model) {\n\t\t\t\tselectedModelId = '';\n\t\t\t}\n\t\t}\n\n\t\tconst dropzoneElement = document.getElementById('note-editor');\n\n\t\tdropzoneElement?.addEventListener('dragover', onDragOver);\n\t\tdropzoneElement?.addEventListener('drop', onDrop);\n\t\tdropzoneElement?.addEventListener('dragleave', onDragLeave);\n\t});\n\n\tonDestroy(() => {\n\t\tconsole.log('destroy');\n\t\tconst dropzoneElement = document.getElementById('note-editor');\n\n\t\tif (dropzoneElement) {\n\t\t\tdropzoneElement?.removeEventListener('dragover', onDragOver);\n\t\t\tdropzoneElement?.removeEventListener('drop', onDrop);\n\t\t\tdropzoneElement?.removeEventListener('dragleave', onDragLeave);\n\t\t}\n\t});\n</script>\n\n<FilesOverlay show={dragged} />\n\n<DeleteConfirmDialog\n\tbind:show={showDeleteConfirm}\n\ttitle={$i18n.t('Delete note?')}\n\ton:confirm={() => {\n\t\tdeleteNoteHandler(note.id);\n\t\tshowDeleteConfirm = false;\n\t}}\n>\n\t<div class=\" text-sm text-gray-500\">\n\t\t{$i18n.t('This will delete')} <span class=\"  font-semibold\">{note.title}</span>.\n\t</div>\n</DeleteConfirmDialog>\n\n<div class=\"relative flex-1 w-full h-full flex justify-center\" id=\"note-editor\">\n\t<Sidebar bind:show={showSettings} className=\" bg-white dark:bg-gray-900\" width=\"300px\">\n\t\t<div class=\"flex flex-col px-5 py-3 text-sm\">\n\t\t\t<div class=\"flex justify-between items-center mb-2\">\n\t\t\t\t<div class=\" font-medium text-base\">Settings</div>\n\n\t\t\t\t<div class=\" translate-x-1.5\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"p-1.5 bg-transparent hover:bg-white/5 transition rounded-lg\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tshowSettings = !showSettings;\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<ArrowRight className=\"size-3\" strokeWidth=\"2.5\" />\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\"mt-1\">\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\" text-xs font-medium mb-1\">Model</div>\n\n\t\t\t\t\t<div class=\"w-full\">\n\t\t\t\t\t\t<select\n\t\t\t\t\t\t\tclass=\"w-full bg-transparent text-sm outline-hidden\"\n\t\t\t\t\t\t\tbind:value={selectedModelId}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<option value=\"\" class=\"bg-gray-50 dark:bg-gray-700\" disabled>\n\t\t\t\t\t\t\t\t{$i18n.t('Select a model')}\n\t\t\t\t\t\t\t</option>\n\t\t\t\t\t\t\t{#each $models.filter((model) => !(model?.info?.meta?.hidden ?? false)) as model}\n\t\t\t\t\t\t\t\t<option value={model.id} class=\"bg-gray-50 dark:bg-gray-700\">{model.name}</option>\n\t\t\t\t\t\t\t{/each}\n\t\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</Sidebar>\n\n\t{#if loading}\n\t\t<div class=\" absolute top-0 bottom-0 left-0 right-0 flex\">\n\t\t\t<div class=\"m-auto\">\n\t\t\t\t<Spinner />\n\t\t\t</div>\n\t\t</div>\n\t{:else}\n\t\t<div class=\" w-full flex flex-col {loading ? 'opacity-20' : ''}\">\n\t\t\t<div class=\"shrink-0 w-full flex justify-between items-center px-4.5 mb-1.5\">\n\t\t\t\t<div class=\"w-full flex items-center\">\n\t\t\t\t\t<input\n\t\t\t\t\t\tclass=\"w-full text-2xl font-medium bg-transparent outline-hidden\"\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tbind:value={note.title}\n\t\t\t\t\t\tplaceholder={$i18n.t('Title')}\n\t\t\t\t\t\trequired\n\t\t\t\t\t/>\n\n\t\t\t\t\t<div class=\"flex items-center gap-2 translate-x-1\">\n\t\t\t\t\t\t{#if note.data?.versions?.length > 0}\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-0.5 self-center min-w-fit\" dir=\"ltr\">\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:enabled:bg-black/5 dark:hover:enabled:bg-white/5 dark:hover:enabled:text-white hover:enabled:text-black rounded-md transition disabled:cursor-not-allowed disabled:text-gray-500 disabled:hover:text-gray-500\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tversionNavigateHandler('prev');\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tdisabled={(versionIdx === null && note.data.versions.length === 0) ||\n\t\t\t\t\t\t\t\t\t\t\tversionIdx === 0}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<ArrowUturnLeft className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t</button>\n\n\t\t\t\t\t\t\t\t\t<button\n\t\t\t\t\t\t\t\t\t\tclass=\"self-center p-1 hover:enabled:bg-black/5 dark:hover:enabled:bg-white/5 dark:hover:enabled:text-white hover:enabled:text-black rounded-md transition disabled:cursor-not-allowed disabled:text-gray-500 disabled:hover:text-gray-500\"\n\t\t\t\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\t\t\t\tversionNavigateHandler('next');\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\tdisabled={versionIdx >= note.data.versions.length || versionIdx === null}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t<ArrowUturnRight className=\"size-4\" />\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t<NoteMenu\n\t\t\t\t\t\t\tonDownload={(type) => {\n\t\t\t\t\t\t\t\tdownloadHandler(type);\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tonCopyToClipboard={async () => {\n\t\t\t\t\t\t\t\tconst res = await copyToClipboard(note.data.content.md).catch((error) => {\n\t\t\t\t\t\t\t\t\ttoast.error(`${error}`);\n\t\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\t\t\ttoast.success($i18n.t('Copied to clipboard'));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\tonDelete={() => {\n\t\t\t\t\t\t\t\tshowDeleteConfirm = true;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<EllipsisHorizontal className=\"size-5\" />\n\t\t\t\t\t\t</NoteMenu>\n\n\t\t\t\t\t\t<button\n\t\t\t\t\t\t\tclass=\"p-1.5 bg-transparent hover:bg-white/5 transition rounded-lg\"\n\t\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\t\tshowSettings = !showSettings;\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Cog6 />\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div class=\" mb-2.5 px-3.5\">\n\t\t\t\t<div class=\"flex gap-1 items-center text-xs font-medium text-gray-500 dark:text-gray-500\">\n\t\t\t\t\t<button class=\" flex items-center gap-1 w-fit py-1 px-1.5 rounded-lg\">\n\t\t\t\t\t\t<Calendar className=\"size-3.5\" strokeWidth=\"2\" />\n\n\t\t\t\t\t\t<span>{dayjs(note.created_at / 1000000).calendar()}</span>\n\t\t\t\t\t</button>\n\n\t\t\t\t\t<button class=\" flex items-center gap-1 w-fit py-1 px-1.5 rounded-lg\">\n\t\t\t\t\t\t<Users className=\"size-3.5\" strokeWidth=\"2\" />\n\n\t\t\t\t\t\t<span> You </span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div\n\t\t\t\tclass=\" flex-1 w-full h-full overflow-auto px-4 pb-20 relative\"\n\t\t\t\tid=\"note-content-container\"\n\t\t\t>\n\t\t\t\t{#if enhancing}\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"w-full h-full fixed top-0 left-0 {streaming\n\t\t\t\t\t\t\t? ''\n\t\t\t\t\t\t\t: ' backdrop-blur-xs  bg-white/10 dark:bg-gray-900/10'} flex items-center justify-center z-10 cursor-not-allowed\"\n\t\t\t\t\t></div>\n\t\t\t\t{/if}\n\n\t\t\t\t{#if files && files.length > 0}\n\t\t\t\t\t<div class=\"mb-3.5 mt-1.5 w-full flex gap-1 flex-wrap z-40\">\n\t\t\t\t\t\t{#each files as file, fileIdx}\n\t\t\t\t\t\t\t<div class=\"w-fit\">\n\t\t\t\t\t\t\t\t{#if file.type === 'image'}\n\t\t\t\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\t\t\t\tsrc={file.url}\n\t\t\t\t\t\t\t\t\t\timageClassName=\" max-h-96 rounded-lg\"\n\t\t\t\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\t\t\t\tonDismiss={() => {\n\t\t\t\t\t\t\t\t\t\t\tfiles = files.filter((item, idx) => idx !== fileIdx);\n\t\t\t\t\t\t\t\t\t\t\tnote.data.files = files.length > 0 ? files : null;\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t<FileItem\n\t\t\t\t\t\t\t\t\t\titem={file}\n\t\t\t\t\t\t\t\t\t\tdismissible={true}\n\t\t\t\t\t\t\t\t\t\turl={file.url}\n\t\t\t\t\t\t\t\t\t\tname={file.name}\n\t\t\t\t\t\t\t\t\t\ttype={file.type}\n\t\t\t\t\t\t\t\t\t\tsize={file?.size}\n\t\t\t\t\t\t\t\t\t\tloading={file.status === 'uploading'}\n\t\t\t\t\t\t\t\t\t\ton:dismiss={() => {\n\t\t\t\t\t\t\t\t\t\t\tfiles = files.filter((item) => item?.id !== file.id);\n\t\t\t\t\t\t\t\t\t\t\tnote.data.files = files.length > 0 ? files : null;\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/each}\n\t\t\t\t\t</div>\n\t\t\t\t{/if}\n\n\t\t\t\t<RichTextInput\n\t\t\t\t\tclassName=\"input-prose-sm px-0.5\"\n\t\t\t\t\tbind:value={note.data.content.json}\n\t\t\t\t\tplaceholder={$i18n.t('Write something...')}\n\t\t\t\t\thtml={note.data?.content?.html}\n\t\t\t\t\tjson={true}\n\t\t\t\t\teditable={versionIdx === null && !enhancing}\n\t\t\t\t\tonChange={(content) => {\n\t\t\t\t\t\tnote.data.content.html = content.html;\n\t\t\t\t\t\tnote.data.content.md = content.md;\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</div>\n\t{/if}\n</div>\n\n<div\n\tclass=\"absolute z-20 bottom-0 right-0 p-5 max-w-full {$showSidebar\n\t\t? 'md:max-w-[calc(100%-260px)]'\n\t\t: ''} w-full flex justify-end\"\n>\n\t<div class=\"flex gap-1 justify-between w-full max-w-full\">\n\t\t{#if recording}\n\t\t\t<div class=\"flex-1 w-full\">\n\t\t\t\t<VoiceRecording\n\t\t\t\t\tbind:recording\n\t\t\t\t\tclassName=\"p-1 w-full max-w-full\"\n\t\t\t\t\ttranscribe={false}\n\t\t\t\t\tdisplayMedia={displayMediaRecord}\n\t\t\t\t\tonCancel={() => {\n\t\t\t\t\t\trecording = false;\n\t\t\t\t\t\tdisplayMediaRecord = false;\n\t\t\t\t\t}}\n\t\t\t\t\tonConfirm={(data) => {\n\t\t\t\t\t\tif (data?.file) {\n\t\t\t\t\t\t\tuploadFileHandler(data?.file);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\trecording = false;\n\t\t\t\t\t\tdisplayMediaRecord = false;\n\t\t\t\t\t}}\n\t\t\t\t/>\n\t\t\t</div>\n\t\t{:else}\n\t\t\t<RecordMenu\n\t\t\t\tonRecord={async () => {\n\t\t\t\t\tdisplayMediaRecord = false;\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tlet stream = await navigator.mediaDevices\n\t\t\t\t\t\t\t.getUserMedia({ audio: true })\n\t\t\t\t\t\t\t.catch(function (err) {\n\t\t\t\t\t\t\t\ttoast.error(\n\t\t\t\t\t\t\t\t\t$i18n.t(`Permission denied when accessing microphone: {{error}}`, {\n\t\t\t\t\t\t\t\t\t\terror: err\n\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (stream) {\n\t\t\t\t\t\t\trecording = true;\n\t\t\t\t\t\t\tconst tracks = stream.getTracks();\n\t\t\t\t\t\t\ttracks.forEach((track) => track.stop());\n\t\t\t\t\t\t}\n\t\t\t\t\t\tstream = null;\n\t\t\t\t\t} catch {\n\t\t\t\t\t\ttoast.error($i18n.t('Permission denied when accessing microphone'));\n\t\t\t\t\t}\n\t\t\t\t}}\n\t\t\t\tonCaptureAudio={async () => {\n\t\t\t\t\tdisplayMediaRecord = true;\n\n\t\t\t\t\trecording = true;\n\t\t\t\t}}\n\t\t\t\tonUpload={async () => {\n\t\t\t\t\tconst input = document.createElement('input');\n\t\t\t\t\tinput.type = 'file';\n\t\t\t\t\tinput.accept = 'audio/*';\n\t\t\t\t\tinput.multiple = false;\n\t\t\t\t\tinput.click();\n\n\t\t\t\t\tinput.onchange = async (e) => {\n\t\t\t\t\t\tconst files = e.target.files;\n\n\t\t\t\t\t\tif (files && files.length > 0) {\n\t\t\t\t\t\t\tawait uploadFileHandler(files[0]);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<Tooltip content={$i18n.t('Record')} placement=\"top\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"cursor-pointer p-2.5 flex rounded-full border border-gray-50 bg-white dark:border-none dark:bg-gray-850 hover:bg-gray-50 dark:hover:bg-gray-800 transition shadow-xl\"\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<MicSolid className=\"size-4.5\" />\n\t\t\t\t\t</button>\n\t\t\t\t</Tooltip>\n\t\t\t</RecordMenu>\n\n\t\t\t<div\n\t\t\t\tclass=\"cursor-pointer flex gap-0.5 rounded-full border border-gray-50 dark:border-gray-850 dark:bg-gray-850 transition shadow-xl\"\n\t\t\t>\n\t\t\t\t<!-- <Tooltip content={$i18n.t('My Notes')} placement=\"top\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"p-2 size-8.5 flex justify-center items-center {selectedVersion === 'note'\n\t\t\t\t\t\t\t? 'bg-gray-100 dark:bg-gray-800 '\n\t\t\t\t\t\t\t: ' hover:bg-gray-50 dark:hover:bg-gray-800'}  rounded-full transition shrink-0\"\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tselectedVersion = 'note';\n\t\t\t\t\t\t\tversionToggleHandler();\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<Bars3BottomLeft />\n\t\t\t\t\t</button>\n\t\t\t\t</Tooltip> -->\n\n\t\t\t\t<Tooltip content={$i18n.t('Enhance')} placement=\"top\">\n\t\t\t\t\t<button\n\t\t\t\t\t\tclass=\"{enhancing\n\t\t\t\t\t\t\t? 'p-2'\n\t\t\t\t\t\t\t: 'p-2.5'} flex justify-center items-center hover:bg-gray-50 dark:hover:bg-gray-800 rounded-full transition shrink-0\"\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tenhanceNoteHandler();\n\t\t\t\t\t\t}}\n\t\t\t\t\t\tdisabled={enhancing}\n\t\t\t\t\t\ttype=\"button\"\n\t\t\t\t\t>\n\t\t\t\t\t\t{#if enhancing}\n\t\t\t\t\t\t\t<Spinner className=\"size-5\" />\n\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t<SparklesSolid />\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</button>\n\t\t\t\t</Tooltip>\n\t\t\t</div>\n\t\t{/if}\n\t</div>\n</div>\n","<script lang=\"ts\">\n\timport { page } from '$app/stores';\n\timport NoteEditor from '$lib/components/notes/NoteEditor.svelte';\n</script>\n\n<NoteEditor id={$page.params.id} />\n"],"names":["LocalizedFormat","stream","uuidv4","note","DeleteConfirmDialog","files"],"mappings":"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"}