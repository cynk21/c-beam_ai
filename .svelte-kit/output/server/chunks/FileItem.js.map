{"version":3,"file":"FileItem.js","sources":["../../../../src/lib/components/common/FileItemModal.svelte","../../../../src/lib/components/common/FileItem.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { getContext, onMount } from 'svelte';\n\timport { formatFileSize, getLineCount } from '$lib/utils';\n\timport { WEBUI_API_BASE_URL } from '$lib/constants';\n\n\tconst i18n = getContext('i18n');\n\n\timport Modal from './Modal.svelte';\n\timport XMark from '../icons/XMark.svelte';\n\timport Info from '../icons/Info.svelte';\n\timport Switch from './Switch.svelte';\n\timport Tooltip from './Tooltip.svelte';\n\n\texport let item;\n\texport let show = false;\n\texport let edit = false;\n\n\tlet enableFullContent = false;\n\n\tlet isPdf = false;\n\tlet isAudio = false;\n\n\t$: isPDF =\n\t\titem?.meta?.content_type === 'application/pdf' ||\n\t\t(item?.name && item?.name.toLowerCase().endsWith('.pdf'));\n\n\t$: isAudio =\n\t\t(item?.meta?.content_type ?? '').startsWith('audio/') ||\n\t\t(item?.name && item?.name.toLowerCase().endsWith('.mp3')) ||\n\t\t(item?.name && item?.name.toLowerCase().endsWith('.wav')) ||\n\t\t(item?.name && item?.name.toLowerCase().endsWith('.ogg')) ||\n\t\t(item?.name && item?.name.toLowerCase().endsWith('.m4a')) ||\n\t\t(item?.name && item?.name.toLowerCase().endsWith('.webm'));\n\n\tonMount(() => {\n\t\tconsole.log(item);\n\t\tif (item?.context === 'full') {\n\t\t\tenableFullContent = true;\n\t\t}\n\t});\n</script>\n\n<Modal bind:show size=\"lg\">\n\t<div class=\"font-primary px-6 py-5 w-full flex flex-col justify-center dark:text-gray-400\">\n\t\t<div class=\" pb-2\">\n\t\t\t<div class=\"flex items-start justify-between\">\n\t\t\t\t<div>\n\t\t\t\t\t<div class=\" font-medium text-lg dark:text-gray-100\">\n\t\t\t\t\t\t<a\n\t\t\t\t\t\t\thref=\"#\"\n\t\t\t\t\t\t\tclass=\"hover:underline line-clamp-1\"\n\t\t\t\t\t\t\ton:click|preventDefault={() => {\n\t\t\t\t\t\t\t\tif (!isPDF && item.url) {\n\t\t\t\t\t\t\t\t\twindow.open(\n\t\t\t\t\t\t\t\t\t\titem.type === 'file' ? `${item.url}/content` : `${item.url}`,\n\t\t\t\t\t\t\t\t\t\t'_blank'\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{item?.name ?? 'File'}\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\n\t\t\t\t<div>\n\t\t\t\t\t<button\n\t\t\t\t\t\ton:click={() => {\n\t\t\t\t\t\t\tshow = false;\n\t\t\t\t\t\t}}\n\t\t\t\t\t>\n\t\t\t\t\t\t<XMark />\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<div>\n\t\t\t\t<div class=\"flex flex-col items-center md:flex-row gap-1 justify-between w-full\">\n\t\t\t\t\t<div class=\" flex flex-wrap text-sm gap-1 text-gray-500\">\n\t\t\t\t\t\t{#if item.size}\n\t\t\t\t\t\t\t<div class=\"capitalize shrink-0\">{formatFileSize(item.size)}</div>\n\t\t\t\t\t\t\tâ€¢\n\t\t\t\t\t\t{/if}\n\n\t\t\t\t\t\t{#if item?.file?.data?.content}\n\t\t\t\t\t\t\t<div class=\"capitalize shrink-0\">\n\t\t\t\t\t\t\t\t{getLineCount(item?.file?.data?.content ?? '')} extracted lines\n\t\t\t\t\t\t\t</div>\n\n\t\t\t\t\t\t\t<div class=\"flex items-center gap-1 shrink-0\">\n\t\t\t\t\t\t\t\t<Info />\n\n\t\t\t\t\t\t\t\tFormatting may be inconsistent from source.\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{/if}\n\t\t\t\t\t</div>\n\n\t\t\t\t\t{#if edit}\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<Tooltip\n\t\t\t\t\t\t\t\tcontent={enableFullContent\n\t\t\t\t\t\t\t\t\t? $i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t'Inject the entire content as context for comprehensive processing, this is recommended for complex queries.'\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t: $i18n.t(\n\t\t\t\t\t\t\t\t\t\t\t'Default to segmented retrieval for focused and relevant content extraction, this is recommended for most cases.'\n\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div class=\"flex items-center gap-1.5 text-xs\">\n\t\t\t\t\t\t\t\t\t{#if enableFullContent}\n\t\t\t\t\t\t\t\t\t\tUsing Entire Document\n\t\t\t\t\t\t\t\t\t{:else}\n\t\t\t\t\t\t\t\t\t\tUsing Focused Retrieval\n\t\t\t\t\t\t\t\t\t{/if}\n\t\t\t\t\t\t\t\t\t<Switch\n\t\t\t\t\t\t\t\t\t\tbind:state={enableFullContent}\n\t\t\t\t\t\t\t\t\t\ton:change={(e) => {\n\t\t\t\t\t\t\t\t\t\t\titem.context = e.detail ? 'full' : undefined;\n\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Tooltip>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div class=\"max-h-[75vh] overflow-auto\">\n\t\t\t{#if isPDF}\n\t\t\t\t<iframe\n\t\t\t\t\ttitle={item?.name}\n\t\t\t\t\tsrc={`${WEBUI_API_BASE_URL}/files/${item.id}/content`}\n\t\t\t\t\tclass=\"w-full h-[70vh] border-0 rounded-lg mt-4\"\n\t\t\t\t/>\n\t\t\t{:else}\n\t\t\t\t{#if isAudio}\n\t\t\t\t\t<audio\n\t\t\t\t\t\tsrc={`${WEBUI_API_BASE_URL}/files/${item.id}/content`}\n\t\t\t\t\t\tclass=\"w-full border-0 rounded-lg mb-2\"\n\t\t\t\t\t\tcontrols\n\t\t\t\t\t\tplaysinline\n\t\t\t\t\t/>\n\t\t\t\t{/if}\n\n\t\t\t\t<div class=\"max-h-96 overflow-scroll scrollbar-hidden text-xs whitespace-pre-wrap\">\n\t\t\t\t\t{item?.file?.data?.content ?? 'No content'}\n\t\t\t\t</div>\n\t\t\t{/if}\n\t\t</div>\n\t</div>\n</Modal>\n","<script lang=\"ts\">\n\timport { createEventDispatcher, getContext } from 'svelte';\n\timport { formatFileSize } from '$lib/utils';\n\n\timport FileItemModal from './FileItemModal.svelte';\n\timport GarbageBin from '../icons/GarbageBin.svelte';\n\timport Spinner from './Spinner.svelte';\n\timport Tooltip from './Tooltip.svelte';\n\n\tconst i18n = getContext('i18n');\n\tconst dispatch = createEventDispatcher();\n\n\texport let className = 'w-60';\n\texport let colorClassName = 'bg-white dark:bg-gray-850 border border-gray-50 dark:border-white/5';\n\texport let url: string | null = null;\n\n\texport let dismissible = false;\n\texport let loading = false;\n\n\texport let item = null;\n\texport let edit = false;\n\texport let small = false;\n\n\texport let name: string;\n\texport let type: string;\n\texport let size: number;\n\n\timport { deleteFileById } from '$lib/apis/files';\n\n\tlet showModal = false;\n\n\tconst decodeString = (str: string) => {\n\t\ttry {\n\t\t\treturn decodeURIComponent(str);\n\t\t} catch (e) {\n\t\t\treturn str;\n\t\t}\n\t};\n</script>\n\n{#if item}\n\t<FileItemModal bind:show={showModal} bind:item {edit} />\n{/if}\n\n<button\n\tclass=\"relative group p-1.5 {className} flex items-center gap-1 {colorClassName} {small\n\t\t? 'rounded-xl'\n\t\t: 'rounded-2xl'} text-left\"\n\ttype=\"button\"\n\ton:click={async () => {\n\t\tif (item?.file?.data?.content) {\n\t\t\tshowModal = !showModal;\n\t\t} else {\n\t\t\tif (url) {\n\t\t\t\tif (type === 'file') {\n\t\t\t\t\twindow.open(`${url}/content`, '_blank').focus();\n\t\t\t\t} else {\n\t\t\t\t\twindow.open(`${url}`, '_blank').focus();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tdispatch('click');\n\t}}\n>\n\t{#if !small}\n\t\t<div class=\"p-3 bg-black/20 dark:bg-white/10 text-white rounded-xl\">\n\t\t\t{#if !loading}\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tviewBox=\"0 0 24 24\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\tclass=\" size-5\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\tfill-rule=\"evenodd\"\n\t\t\t\t\t\td=\"M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0 0 16.5 9h-1.875a1.875 1.875 0 0 1-1.875-1.875V5.25A3.75 3.75 0 0 0 9 1.5H5.625ZM7.5 15a.75.75 0 0 1 .75-.75h7.5a.75.75 0 0 1 0 1.5h-7.5A.75.75 0 0 1 7.5 15Zm.75 2.25a.75.75 0 0 0 0 1.5H12a.75.75 0 0 0 0-1.5H8.25Z\"\n\t\t\t\t\t\tclip-rule=\"evenodd\"\n\t\t\t\t\t/>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M12.971 1.816A5.23 5.23 0 0 1 14.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 0 1 3.434 1.279 9.768 9.768 0 0 0-6.963-6.963Z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t{:else}\n\t\t\t\t<Spinner />\n\t\t\t{/if}\n\t\t</div>\n\t{/if}\n\n\t{#if !small}\n\t\t<div class=\"flex flex-col justify-center -space-y-0.5 px-2.5 w-full\">\n\t\t\t<div class=\" dark:text-gray-100 text-sm font-medium line-clamp-1 mb-1\">\n\t\t\t\t{decodeString(name)}\n\t\t\t</div>\n\n\t\t\t<div class=\" flex justify-between text-gray-500 text-xs line-clamp-1\">\n\t\t\t\t{#if type === 'file'}\n\t\t\t\t\t{$i18n.t('File')}\n\t\t\t\t{:else if type === 'doc'}\n\t\t\t\t\t{$i18n.t('Document')}\n\t\t\t\t{:else if type === 'collection'}\n\t\t\t\t\t{$i18n.t('Collection')}\n\t\t\t\t{:else}\n\t\t\t\t\t<span class=\" capitalize line-clamp-1\">{type}</span>\n\t\t\t\t{/if}\n\t\t\t\t{#if size}\n\t\t\t\t\t<span class=\"capitalize\">{formatFileSize(size)}</span>\n\t\t\t\t{/if}\n\t\t\t</div>\n\t\t</div>\n\t{:else}\n\t\t<Tooltip content={decodeString(name)} className=\"flex flex-col w-full\" placement=\"top-start\">\n\t\t\t<div class=\"flex flex-col justify-center -space-y-0.5 px-2.5 w-full\">\n\t\t\t\t<div class=\" dark:text-gray-100 text-sm flex justify-between items-center\">\n\t\t\t\t\t{#if loading}\n\t\t\t\t\t\t<div class=\" shrink-0 mr-2\">\n\t\t\t\t\t\t\t<Spinner className=\"size-4\" />\n\t\t\t\t\t\t</div>\n\t\t\t\t\t{/if}\n\t\t\t\t\t<div class=\"font-medium line-clamp-1 flex-1\">{decodeString(name)}</div>\n\t\t\t\t\t<div class=\"text-gray-500 text-xs capitalize shrink-0\">{formatFileSize(size)}</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</Tooltip>\n\t{/if}\n\n\t{#if dismissible}\n\t\t<div class=\" absolute -top-1 -right-1\">\n\t\t\t<button\n\t\t\t\tclass=\" bg-white text-black border border-gray-50 rounded-full group-hover:visible invisible transition\"\n\t\t\t\ttype=\"button\"\n\t\t\t\ton:click|stopPropagation={() => {\n\t\t\t\t\tdispatch('dismiss');\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<svg\n\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\"\n\t\t\t\t\tviewBox=\"0 0 20 20\"\n\t\t\t\t\tfill=\"currentColor\"\n\t\t\t\t\tclass=\"w-4 h-4\"\n\t\t\t\t>\n\t\t\t\t\t<path\n\t\t\t\t\t\td=\"M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z\"\n\t\t\t\t\t/>\n\t\t\t\t</svg>\n\t\t\t</button>\n\n\t\t\t<!-- <button\n\t\t\t\tclass=\" p-1 dark:text-gray-300 dark:hover:text-white hover:bg-black/5 dark:hover:bg-white/5 rounded-full group-hover:visible invisible transition\"\n\t\t\t\ttype=\"button\"\n\t\t\t\ton:click={() => {\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<GarbageBin />\n\t\t\t</button> -->\n\t\t</div>\n\t{/if}\n</button>\n"],"names":[],"mappings":"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"}